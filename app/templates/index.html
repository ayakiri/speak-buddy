<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeakBuddy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h1>SpeakBuddy</h1>
    <h3>Twój przyjaciel w nauce języka angielskiego</h3>



    <form id="messageForm">
        <label for="message">Rozmawiaj ze swoim kolegą po angielsku! Wpisz tutaj swoją wiadomość:</label>
        <input type="text" id="message" name="message" required>
        <button type="button" id="sendButton">Send</button>
    </form>

    <h2>Nasza rozmowa:</h2>
    <div id="conversation">
        <!-- Messages and responses here -->
    </div>

    <script>
        document.getElementById('sendButton').addEventListener('click', async () => {
            const message = document.getElementById('message').value;

            if (!message) {
                alert("Please enter a message!");
                return;
            }

            appendMessage('You: ' + message);

            try {
                const answerResponse = await fetch('/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message }),
                });

                if (!answerResponse.ok) {
                    throw new Error('Failed to get an answer');
                }

                const answerData = await answerResponse.json();
                console.log('Answer data:', answerData);

                if (answerData && answerData.response) {
                    appendMessage('Server (Answer): ' + answerData.response);
                } else {
                    appendMessage('Server (Answer): No answer available');
                }

                const correctResponse = await fetch('/correct', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                });

                if (!correctResponse.ok) {
                    throw new Error('Failed to get correction');
                }

                // Parse the response from /correct
                const correctData = await correctResponse.json();
                console.log('Corrected data:', correctData);

                if (correctData && correctData.corrected) {
                    appendMessage('Server (Corrected): ' + correctData.corrected);
                } else {
                    appendMessage('Server (Corrected): No corrected text available');
                }
            } catch (error) {
                console.error('Error:', error);
                appendMessage('Error: Unable to process your request.');
            }

            document.getElementById('message').value = '';
        });

        function appendMessage(message) {
            const conversation = document.getElementById('conversation');
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            conversation.appendChild(messageElement);
        }
    </script>
</body>
</html>
